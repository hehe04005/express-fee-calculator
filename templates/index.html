<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¿«é€’è´¹ç”¨æ ¸ç®—å·¥å…· (å¤§æ•°æ®ç‰ˆ)</title>
    <style>
        body { font-family: 'Microsoft YaHei', Arial, sans-serif; max-width: 1000px; margin: 0 auto; padding: 20px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; }
        .container { background: white; border-radius: 15px; padding: 30px; box-shadow: 0 10px 30px rgba(0,0,0,0.3); }
        h1 { color: #333; text-align: center; margin-bottom: 30px; font-size: 28px; }
        .rules { background: #f8f9fa; border-left: 4px solid #007bff; padding: 20px; margin-bottom: 30px; border-radius: 5px; }
        .form-group { margin-bottom: 20px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        input[type="file"], select { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px; }
        .radio-group { display: flex; gap: 20px; margin-bottom: 15px; }
        .btn { padding: 12px 24px; background: #28a745; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 16px; }
        .btn:hover { background: #218838; }
        .btn:disabled { background: #6c757d; cursor: not-allowed; }
        .progress { width: 100%; height: 20px; background: #e9ecef; border-radius: 10px; overflow: hidden; margin: 10px 0; display: none; }
        .progress-bar { height: 100%; background: linear-gradient(90deg, #28a745, #20c997); width: 0%; transition: width 0.3s; }
        .results { margin-top: 30px; display: none; }
        .stats { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px; }
        .stat-card { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 15px; border-radius: 8px; text-align: center; }
        .stat-value { font-size: 20px; font-weight: bold; }
        .stat-label { font-size: 12px; opacity: 0.9; }
        .error { color: #dc3545; margin-top: 10px; }
        .success { color: #28a745; margin-top: 10px; }
        .processing { color: #17a2b8; margin-top: 10px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ“¦ å¿«é€’è´¹ç”¨æ ¸ç®—å·¥å…· (å¤§æ•°æ®ç‰ˆ)</h1>
        
        <div class="rules">
            <h3>ğŸ“‹ åŠŸèƒ½è¯´æ˜</h3>
            <ul>
                <li><strong>å°éº¦è®¡è´¹ï¼š</strong>10.5kg(Â±0.5)ã€12.5kg(Â±0.5)ã€21kg(Â±1)ä¸‰æ¡£ï¼ŒåŒºåˆ†æ²³å—çœå†…å¤–</li>
                <li><strong>ç‰ç±³è®¡è´¹ï¼š</strong>æŒ‰é‡é‡å’Œçœä»½åˆ†çº§ï¼Œè¶…3kgé‡‡ç”¨é¦–é‡+ç»­é‡æ¨¡å¼</li>
                <li><strong>é™„åŠ è´¹ç”¨ï¼š</strong>å¯é€‰ä¸Šä¼ ï¼Œé€šè¿‡è¿å•å·åŒ¹é…ç»“ç®—é‡‘é¢</li>
                <li><strong>å¤§æ•°æ®æ”¯æŒï¼š</strong>å¯å¤„ç†æ•°ä¸‡æ¡è®°å½•ï¼Œè‡ªåŠ¨ç”ŸæˆExcelæŠ¥å‘Š</li>
            </ul>
        </div>
        
        <form id="uploadForm" enctype="multipart/form-data">
            <div class="form-group">
                <label>é€‰æ‹©äº§å“ç±»å‹ï¼š</label>
                <div class="radio-group">
                    <label><input type="radio" name="product_type" value="å°éº¦" checked> å°éº¦</label>
                    <label><input type="radio" name="product_type" value="ç‰ç±³"> ç‰ç±³</label>
                </div>
            </div>
            
            <div class="form-group">
                <label for="data_file">å¿«é€’æ•°æ®æ–‡ä»¶ (.csv/.xlsx)ï¼š</label>
                <input type="file" id="data_file" name="data_file" accept=".csv,.xlsx" required>
            </div>
            
            <div class="form-group">
                <label for="fee_file">é™„åŠ è´¹ç”¨æ–‡ä»¶ (å¯é€‰)ï¼š</label>
                <input type="file" id="fee_file" name="fee_file" accept=".csv,.xlsx">
            </div>
            
            <button type="submit" class="btn">ğŸš€ å¼€å§‹è®¡ç®—è´¹ç”¨</button>
            
            <div class="progress" id="progress">
                <div class="progress-bar" id="progressBar"></div>
            </div>
            
            <div id="message"></div>
        </form>
        
        <div class="results" id="results">
            <div class="stats" id="stats"></div>
            <div style="text-align: center;">
                <a id="downloadLink" class="btn" style="text-decoration: none; display: none;">ğŸ“Š ä¸‹è½½è¯¦ç»†ç»“æœ</a>
            </div>
        </div>
    </div>

    <script>
        document.getElementById('uploadForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const formData = new FormData(this);
            const progress = document.getElementById('progress');
            const progressBar = document.getElementById('progressBar');
            const message = document.getElementById('message');
            const results = document.getElementById('results');
            
            progress.style.display = 'block';
            progressBar.style.width = '0%';
            message.innerHTML = '<div class="processing">â³ æ­£åœ¨å¤„ç†æ•°æ®ï¼Œè¯·è€å¿ƒç­‰å¾…...</div>';
            results.style.display = 'none';
            
            try {
                progressBar.style.width = '20%';
                
                const response = await fetch('/upload', {
                    method: 'POST',
                    body: formData
                });
                
                progressBar.style.width = '70%';
                const result = await response.json();
                progressBar.style.width = '100%';
                
                if (result.success) {
                    const stats = result.stats;
                    document.getElementById('stats').innerHTML = `
                        <div class="stat-card">
                            <div class="stat-value">${stats.total_orders}</div>
                            <div class="stat-label">è®¢å•æ€»æ•°</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value">Â¥${stats.total_basic_fee.toFixed(2)}</div>
                            <div class="stat-label">åŸºç¡€è´¹ç”¨</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value">Â¥${stats.total_additional_fee.toFixed(2)}</div>
                            <div class="stat-label">é™„åŠ è´¹ç”¨</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value">Â¥${stats.total_fee.toFixed(2)}</div>
                            <div class="stat-label">æ€»è´¹ç”¨</div>
                        </div>
                    `;
                    
                    const downloadLink = document.getElementById('downloadLink');
                    downloadLink.href = result.download_url;
                    downloadLink.style.display = 'inline-block';
                    
                    results.style.display = 'block';
                    message.innerHTML = '<div class="success">âœ… è®¡ç®—å®Œæˆï¼ç‚¹å‡»ä¸‹è½½æŸ¥çœ‹è¯¦ç»†ç»“æœã€‚</div>';
                } else {
                    message.innerHTML = `<div class="error">âŒ ${result.error}</div>`;
                }
                
            } catch (error) {
                message.innerHTML = `<div class="error">âŒ å¤„ç†å¤±è´¥: ${error.message}</div>`;
            }
            
            setTimeout(() => {
                progress.style.display = 'none';
                progressBar.style.width = '0%';
            }, 2000);
        });
    </script>
</body>
</html>